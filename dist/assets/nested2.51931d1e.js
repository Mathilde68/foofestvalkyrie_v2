var C=Object.defineProperty;var k=Object.getOwnPropertySymbols;var E=Object.prototype.hasOwnProperty,I=Object.prototype.propertyIsEnumerable;var v=(e,t,o)=>t in e?C(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,_=(e,t)=>{for(var o in t||(t={}))E.call(t,o)&&v(e,o,t[o]);if(k)for(var o of k(t))I.call(t,o)&&v(e,o,t[o]);return e};import"./style.7f2dd081.js";window.addEventListener("DOMContentLoaded",B);const T={area:"area",spots:0,available:0};let m=[];const w={total_tickets:0,reg_tickets:0,vip_tickets:0,tent_four:0,tent_two:0},r={id:"",area:"",amount:0,confirmed:!1};let g={fullname:"",adress:"",phone:"",email:"",others:[],total_price:""};console.log(g);const x=localStorage.getItem("tickets");let n=JSON.parse(x);function B(){console.log("start"),document.getElementById("cart_section").style.display="block",document.getElementById("timer_section").style.display="none",L()}function L(){console.log(localStorage),localStorage.getItem("tickets")===null||n.reg_tickets===0&n.vip_tickets===0?(document.querySelector(".cart_p_checkout").style.display="none",document.querySelector(".emptyCart").style.display="block"):(A(),document.querySelector(".cart_p_checkout").style.display="block",document.querySelector(".emptyCart").style.display="none",document.querySelector(".cart_p_checkout").addEventListener("click",N))}function A(){console.log(n);const e=Object.create(w);e.total_tickets=n.total_tickets,e.reg_tickets=n.reg_tickets,e.vip_tickets=n.vip_tickets,e.tent_four=n.tent_four,e.tent_two=n.tent_two,O(e)}function O(e){const t=document.querySelector("#cart").content.cloneNode(!0),o=799,l=1299,i=299,c=399,a="VIP Festival Ticket",p="Regular Festival Ticket",y="2 Person tent",s="4 Person tent",d=o*e.reg_tickets,u=l*e.vip_tickets,f=i*e.tent_two,h=c*e.tent_four,b=d+u+f+h+99;t.querySelector("[data-field=cart_regu_ticket]").textContent=p,t.querySelector("[data-field=cart_regu_quantity]").textContent=e.reg_tickets+"x",t.querySelector("[data-field=cart_regu_price]").textContent=o,t.querySelector("[data-field=cart_regu_total]").textContent=d+" DKK",t.querySelector("[data-field=cart_vip_ticket]").textContent=a,t.querySelector("[data-field=cart_vip_quantity]").textContent=e.vip_tickets+"x",t.querySelector("[data-field=cart_vip_price]").textContent=l,t.querySelector("[data-field=cart_vip_total]").textContent=u+" DKK",t.querySelector("[data-field=cart_two_tent]").textContent=y,t.querySelector("[data-field=cart_two_tent_quantity]").textContent=e.tent_two+"x",t.querySelector("[data-field=cart_two_tent_price]").textContent=i,t.querySelector("[data-field=cart_two_tent_total]").textContent=f+" DKK",t.querySelector("[data-field=cart_four_tent]").textContent=s,t.querySelector("[data-field=cart_four_tent_quantity]").textContent=e.tent_four+"x",t.querySelector("[data-field=cart_four_tent_price]").textContent=c,t.querySelector("[data-field=cart_four_tent_total]").textContent=h+" DKK",t.querySelector("[data-field=cart_total_total]").textContent=b+" DKK",e.reg_tickets===0&&(t.querySelector("[data-field=cart_regu_ticket]").style.display="none",t.querySelector("[data-field=cart_regu_quantity]").style.display="none",t.querySelector("[data-field=cart_regu_price]").style.display="none",t.querySelector("[data-field=cart_regu_total]").style.display="none"),e.vip_tickets===0&&(t.querySelector("[data-field=cart_vip_ticket]").style.display="none",t.querySelector("[data-field=cart_vip_quantity]").style.display="none",t.querySelector("[data-field=cart_vip_price]").style.display="none",t.querySelector("[data-field=cart_vip_total]").style.display="none"),e.tent_two===0&&(t.querySelector("[data-field=cart_two_tent]").style.display="none",t.querySelector("[data-field=cart_two_tent_quantity]").style.display="none",t.querySelector("[data-field=cart_two_tent_price]").style.display="none",t.querySelector("[data-field=cart_two_tent_total]").style.display="none"),e.tent_four===0&&(t.querySelector("[data-field=cart_four_tent]").style.display="none",t.querySelector("[data-field=cart_four_tent_quantity]").style.display="none",t.querySelector("[data-field=cart_four_tent_price]").style.display="none",t.querySelector("[data-field=cart_four_tent_total]").style.display="none"),document.querySelector("#cart_table").appendChild(t)}function N(){console.log("lol"),document.getElementById("cart_section").style.display="none",document.getElementById("camping_section").style.display="block",document.querySelector(".view_map").addEventListener("click",()=>{document.getElementById("areainfo_popup").style.display="block"}),document.querySelector(".close_map").addEventListener("click",()=>{document.getElementById("areainfo_popup").style.display="none"}),J(),document.querySelector("#choose_area_btn").addEventListener("click",function(e){document.querySelector("#camping").checkValidity()?(document.getElementById("campErr").innerHTML="",e.preventDefault(),D()):document.getElementById("campErr").innerHTML="<p>Please choose a camparea to continue</p>"})}function D(){W(),document.getElementById("camping_section").style.display="none",document.getElementById("costumer_section").style.display="block",document.getElementById("timer_section").style.display="block",document.getElementById("otherTicket_title").style.display="none";for(var e=1;e<n.total_tickets;e++)console.log(e),M();document.querySelector(".p_payment").addEventListener("click",function(t){document.querySelector(".costumer_form form").checkValidity()?(t.preventDefault(),P()):console.log("not valid yet")})}function M(){document.getElementById("otherTicket_title").style.display="block",new X("otherTicket")}function P(){document.body.scrollTop=document.documentElement.scrollTop=0,document.getElementById("costumer_section").style.display="none",document.getElementById("payment_section").style.display="block",document.querySelector(".p_buy").addEventListener("click",function(e){document.querySelector("#card_info").checkValidity()===!0?(e.preventDefault(),V()):console.log("YOU HAVE TO PAY FIRST")})}function $(){document.getElementById("payment_section").style.display="none",document.getElementById("timer_section").style.display="none",document.getElementById("order_popup").style.display="block",document.querySelector(".order_continue").addEventListener("click",()=>{location.href="schedule.html"}),S(),j()}function j(){const e=document.querySelector(".costumer_form form"),t=e.elements.fullname.value,o=e.elements.mail.value,l=e.elements.address.value+", "+e.elements.city.value,i=e.elements.phone.value,c=document.querySelector("[data-field=cart_total_total]").textContent,a=[],p=[];document.querySelectorAll(".fullnames").forEach(d=>{const u={fullname:d.value};a.push(u)}),document.querySelectorAll(".phonenums").forEach(d=>{const u={phone:d.value};p.push(u)});const y=a.map(function(d,u){return[d,p[u]]});let s=Object.create(g);s=_(_({},n),r),s.fullname=t,s.email=o,s.address=l,s.phone=i,s.others=y,s.total_price=c,console.log(s),H(s)}function H(e){const t={name:e.fullname,email:e.email,phone:e.phone,adress:e.address,area:e.area,reg_ticket:e.reg_tickets,vip_ticket:e.vip_tickets,two_tents:e.tent_two,four_tents:e.tent_four,others:e.others,total_price:e.total_price};console.log(t),fetch("https://foobooking-7e65.restdb.io/rest/bookings",{method:"post",headers:{"Content-Type":"application/json","x-apikey":"62965c79c4d5c3756d35a402"},body:JSON.stringify(t)}).then(o=>o.json()).then(o=>{console.log(o),F(e.fullname,e.email,e.total_price)})}function K(){var e;return n.reg_tickets===0?e=` ${n.total_tickets} total tickets; ${n.vip_tickets} VIP tickets`:n.vip_tickets===0?e=` ${n.total_tickets} total tickets: ${n.reg_tickets} Regular tickets`:e=` ${n.total_tickets} total tickets: ${n.reg_tickets} Regular tickets and ${n.vip_tickets} VIP tickets`,e}function R(){var e;return n.tent_four===0&n.tent_two>0?e=` ${n.tent_two} two person tents`:n.tent_two===0&n.tent_four>0?e=` ${n.tent_four} four person tents`:n.tent_four>0&n.tent_two>0?e=` ${n.tent_two} two person tents and ${n.tent_four} four person tents`:e="No tents were purchased - so remember to bring your own ;)",e}function F(e,t,o){const l=K(),i=R(),c={service_id:"service_ngppnvc",template_id:"template_wuxketh",user_id:"dgCgRYkZrhDwvJ2pA",template_params:{to_name:e,to_user:t,tickets:l,tents:i,total:o}};console.log(c),fetch("https://api.emailjs.com/api/v1.0/email/send",{method:"post",body:JSON.stringify(c),headers:{Accept:"application/json","Content-Type":"application/json"}}).then(a=>a.json()).then(a=>{console.log(a)})}function V(){const e={id:r.id};console.log(e),fetch("https://valkyriefest.herokuapp.com/fullfill-reservation",{method:"post",body:JSON.stringify(e),headers:{Accept:"application/json","Content-Type":"application/json"}}).then(t=>t.json()).then(t=>{console.log(t),r.confirmed=!0,console.log(r),$()})}async function J(){const o=await(await fetch("https://valkyriefest.herokuapp.com/available-spots")).json();U(o)}function U(e){m=[],e.forEach(t=>{const o=Object.create(T);o.area=t.area,o.spots=t.spots,o.available=t.available,m.push(o)}),console.log(m),Y()}function Y(){document.querySelector("#camping_one").textContent="",document.querySelector("#camping_two").textContent="",document.querySelector("#camping_three").textContent="",document.querySelector("#camping_four").textContent="",document.querySelector("#camping_five").textContent="",m.forEach(G)}function G(e){document.querySelectorAll("[data-action='area_select']").forEach(a=>a.addEventListener("click",l));const t=document.querySelector("#template_camping").content.cloneNode(!0);t.querySelector("[data-field=spots]").textContent=e.spots+" spots",t.querySelector("[data-field=available]").textContent="Available: "+e.available,e.available===0&&(t.querySelector("[data-field=available]").textContent="SOLD OUT",t.querySelector("[data-field=available]").style.fontWeight="bold",o()),e.area==="Svartheim"&&(document.querySelector("#area_a").textContent=e.area,t.querySelector("[data-field=available]").id="Svartheim_a",document.querySelector("#camping_one").appendChild(t)),e.area==="Nilfheim"&&(document.querySelector("#area_b").textContent=e.area,t.querySelector("[data-field=available]").id="Nilfheim_a",document.querySelector("#camping_two").appendChild(t)),e.area==="Helheim"&&(document.querySelector("#area_c").textContent=e.area,t.querySelector("[data-field=available]").id="Helheim_a",document.querySelector("#camping_three").appendChild(t)),e.area==="Muspelheim"?(document.querySelector("#area_d").textContent=e.area,t.querySelector("[data-field=available]").id="Muspelheim_a",document.querySelector("#camping_four").appendChild(t)):e.area==="Alfheim"&&(document.querySelector("#area_e").textContent=e.area,t.querySelector("[data-field=available]").id="Alfheim_a",document.querySelector("#camping_five").appendChild(t)),e.available<n.total_tickets&&o();function o(){const a=e.area;console.log("disabled "+a),document.getElementById(a).checked=!1,document.getElementById(a).disabled=!0,document.getElementById(a).classList.add("unclickable")}function l(){if(c(),this.value===e.area&&e.available>=n.total_tickets){const a=e.available-n.total_tickets;console.log(a),i(a,this.value),r.area=this.value,r.amount=n.total_tickets,console.log(r)}}function i(a,p){const y=p+"_a";(p=e.area)&&(document.getElementById(y).textContent=`Available: ${a}`)}function c(){const a=e.area+"_a";e.available===0?document.getElementById(a).textContent="SOLD OUT":document.getElementById(a).textContent=`Available: ${e.available}`}}function W(){const e={area:r.area,amount:r.amount},t=JSON.stringify(e);console.log(e),fetch("https://valkyriefest.herokuapp.com/reserve-spot",{method:"put",headers:{"Content-Type":"application/json"},body:t}).then(l=>l.json()).then(l=>{console.log(l),l.id?o(l):console.log("Cannot reserve, no spots available in chosen area")});function o(l){r.id=l.id,console.log(r),S()}}function S(){console.log("timer"),document.querySelector("#timer_section").style.display="block",document.querySelector(".timer").innerHTML="5:00",r.confirmed?Z():q()}function Z(){document.querySelector(".timer").innerHTML="00:00",document.getElementById("timer_section").style.display="none",localStorage.clear("tickets")}function q(){const t=document.querySelector(".timer").innerHTML.split(/[:]+/);let o=t[0],l=z(t[1]-1);l==59&&(o=o-1),!(o<0)&&(document.querySelector(".timer").innerHTML=o+":"+l,setTimeout(q,1e3),l==="00"&&o==="0"&&clearTimeout(setTimeout,Q()))}function z(e){return e<10&&e>=0&&(e="0"+e),e<0&&(e="59"),e}function Q(){console.log("TIMES UP BIIIIIIITCH");const e=document.getElementById("timesup_popup");e.style.display="block",document.querySelector(".timesup_continue").addEventListener("click",t),document.getElementById("timer_section").style.display="none",localStorage.clear("tickets");function t(){const o=document.getElementById("timesup_popup");o.style.display="none",location.href="checkout.html"}}class X{constructor(t){const o=document.createElement("label");o.for="fullname_guest",o.innerHTML="Fullname*";const l=document.createElement("input");l.name="fullname_guest",l.classList.add("fullnames"),l.type="text",l.required=!0;const i=document.createElement("label");i.for="phone_guest",i.innerHTML="Enter your phone number";const c=document.createElement("input");c.name="phone_guest",c.classList.add("phonenums"),c.type="tel",c.maxLength="8",c.pattern="[0-9]+",this.labelName=o,this.inputName=l,this.labelTel=i,this.inputTel=c;const a=document.createElement("div");a.classList.add("others_form"),a.appendChild(o),a.appendChild(l),a.appendChild(i),a.appendChild(c),document.getElementById(t).appendChild(a)}}
